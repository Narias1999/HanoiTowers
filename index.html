<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Drag and drop</title>
	<link rel="stylesheet" type="text/css" href="estilos.css">
</head>
<body>
	<div id="mainFace">
		<h1>Torres de Hanoi</h1>
		<input type="text" id="username" name="username" placeholder="NOMBRE DE USUARIO">
		<p>¿En que nivel vas a jugar?</p>
		<ul>
			<li><a href="#" class="btn" id="easy">Fácil</a></li>
			<li><a href="#" class="btn" id="medium">Medio</a></li>
			<li><a href="#" class="btn" id="hard" >Difícil</a></li>
		</ul>
		<a href="#" class="btn start" id="start">START</a>
	</div>
	<div id="game">
		<div id="bg"></div>
		<div id="juego">
			<div class="aro" id="drag1"></div>
			<div class="aro" id="drag2"></div>
			<div class="aro" id="drag3"></div>
			<div class="aro" id="drag4"></div>
			<div class="aro" id="drag5"></div>
			<div class="aro" id="drag6"></div>
			<div class="aro" id="drag7"></div>
			<div class="aro" id="drag8"></div>
			<div class="tower" id="tower1">
				<div class="torre"></div>
			</div>
			<div class="tower" id="tower2">
				<div class="torre"></div>
			</div>
			<div class="tower" id="tower3">
				<div class="torre"></div>
			</div>
		</div>
		
		<h2 id="user"></h2>
		<div class="points">
			<div class="datos">
				<p>Numero de jugadas: <span id="jugadas"></span></p>
				<p>Tiempo: <span id="minutos">00</span>:<span id="segundos">00</span></p>
			</div>
			<div class="controls">
				<a href="#" class="game-btn" id="pause">Pause</a>
				<a href="index.html" class="game-btn" id="restart">Restart</a>
			</div>
		</div>
	</div>
	<div id="pauseFace">
		<h2>Juego Pausado</h2>
		<a href="#" class="game-btn" id="resume">Continuar</a>
	</div>
	<div id="winFace">
		<h2>¡Felicitaciones!</h2>
		<div class="result">
			<div class="tiempo">
				<h3>Tiempo</h3>
				<p id="time"></p>
			</div>
			<div class="jugadas">
				<h3>Jugadas</h3>
				<p id="moves"></p>
			</div>
		</div>
		<p class="timer">La pantalla de resultados se mostrará en <span id="seconds"></span></p>
	</div>
	<div id="rankingFace" class="ranking-face">
		<section class="resultados">
			<h1>Resultados nivel <span id="resultLevel"></span></h1>
			<table>
				<thead>
					<tr>
						<th>Posicion</th>
						<th>Nombre de Usuario</th>
						<th>Tiempo</th>
						<th>N° de Jugadas</th>
					</tr>
				</thead>
				<tbody id="rankingTable"></tbody>
			</table>
			<a href="../index.html" class="btn start">Volver a Jugar</a>
		</section>
	</div>
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/jquery-ui.min.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.8.2/firebase.js"></script>
	<script>
		// Initialize Firebase
		let pos
		var config = {
			apiKey: "AIzaSyBY6A37cLRnlvmxu_f9QZa1O4f2Hm_onfk",
			authDomain: "hanoitowers-6ef4f.firebaseapp.com",
			databaseURL: "https://hanoitowers-6ef4f.firebaseio.com",
			projectId: "hanoitowers-6ef4f",
			storageBucket: "",
			messagingSenderId: "644478568762"
		};
		firebase.initializeApp(config);
		firebase.database().ref('easy').on("value", snap => {
			const data = snap.val()
			if (data) {
				let arrayData = []
				for (const key in data) {
					arrayData.push(data[key])
				}
				pos = 1
				arrayData.sort(compare)
				let last = null
				arrayData.forEach(e => {
					if (!last) {
						e.pos = 1
						last = e
					} else {
						if (last.minutos == e.minutos && last.jugadas == e.jugadas && last.segundos == e.segundos) {
							e.pos = last.pos
						} else e.pos = last.pos +1
						last = e
					}
				})
				arrayData = arrayData.filter(e => e.pos < 11)
				$('#rankingTable').html('')
				for(const iterable of arrayData) {
					const html = `
					<tr class="user-row">
						<td>${iterable.pos}º</td>
						<td>${iterable.username}</td>
						<td>${iterable.minutos}:${iterable.segundos} m</td>
						<td>${iterable.jugadas}</td>
					</tr>`
					$('#rankingTable').append(html)
											
				}
				
			}

		})
		function compare(a, b) {
			if(a.minutos < b.minutos) return -1		
			else if(a.minutos > b.minutos)return 1
			else {
				if(a.segundos < b.segundos) return -1
				else if(a.segundos > b.segundos) return 1
				else {
					if(a.jugadas < b.jugadas) return -1
					else if(a.jugadas > b.jugadas) return 1
					else return 0
				}
			}
		}
	</script>
	<script type="text/javascript" src="js/codigo.js"></script>
</body>
</html>